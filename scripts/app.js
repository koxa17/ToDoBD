const form=document.getElementById("form"),list=document.querySelector(".list-group"),clearBtn=document.getElementById("btn-clear"),input=document.getElementById("addNewTask");class Task{static sendRequest({url:url,method:method,id:id="",body:body=null}){return fetch(`${url}/${id}.json`,{method:method,body:JSON.stringify(body),headers:{"Content-Type":"application/json;"}}).then(response=>response.ok?response.json():response.json().then(err=>{const e=new Error(`Ошибка: ${response.status}!`);throw e.data=err,e}))}static createTask(task){Task.sendRequest({url:"https://ratatype-c2d32.firebaseio.com/tasks",method:"POST",body:task}).then(data=>(task.id=data.name,task)).then(setToLocalStorage).then(Task.renderList).catch(err=>{console.log(err)}).finally(loadingAnimate)}static renderList(){const tasks=getFromLocalStorage();let liItem=null;tasks.length?(liItem=tasks.map(toList).join(""),clearBtn.disabled="",input.removeEventListener("keydown",animateEmptyList),clearBtn.addEventListener("click",Task.allClear,{once:!0})):(liItem='<li class="list-group-item justify-content-center align-items-center listEmpty">\n            <img src="img/norm.svg" alt="Смайлик" class="emoji">\n            <span class="task-title">Этот список пуст, как и твоя душа!</span>\n            </li>',clearBtn.removeEventListener("click",Task.allClear),clearBtn.disabled=!0,input.addEventListener("keydown",animateEmptyList)),list.innerHTML=liItem}static delete(id){Task.sendRequest({url:"https://ratatype-c2d32.firebaseio.com/tasks",method:"DELETE",id:id}).then(deleteTask(id)).then(Task.renderList)}static allClear(){loadingAnimate(),Task.sendRequest({url:"https://ratatype-c2d32.firebaseio.com/tasks",method:"DELETE"}).then(()=>{localStorage.removeItem("tasks"),Task.renderList()}).finally(loadingAnimate)}static done(id){Task.sendRequest({url:"https://ratatype-c2d32.firebaseio.com/tasks",method:"PATCH",id:id,body:{done:!0}}).then(doneTask(id)).then(Task.renderList)}}function addTask(e){e.preventDefault(),loadingAnimate(),Task.createTask({text:input.value.trim(),date:new Date,done:!1}),input.focus(),form.reset()}function toList(task){return task.done?`<li class="list-group-item d-flex justify-content-between list-group-item-success">\n        <span class="task-title"><span class="strike">${task.text}</span><small class="date">${new Date(task.date).toLocaleDateString()} ${new Date(task.date).toLocaleTimeString()}</small></span>\n        <div data-id="${task.id}">\n            <button type="button" data-action="delete-task" class="btn btn-light align-self-end">Удалить</button>\n        </div>\n        </li>`:`<li class="list-group-item d-flex justify-content-between">\n    <span class="task-title">${task.text}<small class="date">${new Date(task.date).toLocaleDateString()} ${new Date(task.date).toLocaleTimeString()}</small></span>\n    <div data-id="${task.id}">\n        <button type="button" data-action="done-task" class="btn btn-light align-self-end">Готово</button>\n        <button type="button" data-action="delete-task" class="btn btn-light align-self-end">Удалить</button>\n    </div>\n    </li>`}function action(event){const target=event.target;if("delete-task"===target.dataset.action){const id=target.parentElement.dataset.id;Task.delete(id)}else if("done-task"===target.dataset.action){const id=target.parentElement.dataset.id;Task.done(id)}}function deleteTask(id){const all=getFromLocalStorage();all.splice(all.findIndex(task=>task.id===id),1),localStorage.setItem("tasks",JSON.stringify(all))}function doneTask(id){const all=getFromLocalStorage();all.map(item=>item.id===id&&(item.done=!0)),localStorage.setItem("tasks",JSON.stringify(all))}function loadingAnimate(){const loading=document.querySelector(".loading");if(loading.children.length>0)return loading.textContent="",void(loading.style.display="none");loading.style.display="flex",loading.insertAdjacentHTML("afterbegin",'<img src="img/loading.gif" alt="" class="loading__img">')}function setToLocalStorage(task){let all=getFromLocalStorage();all.push(task),localStorage.setItem("tasks",JSON.stringify(all))}function getFromLocalStorage(){return JSON.parse(localStorage.getItem("tasks")||"[]")}function animateEmptyList(event){const emoji=document.getElementsByClassName("emoji")[0],emptyTitle=document.getElementsByClassName("task-title")[0];"Backspace"===event.key?(emoji.src="img/backspace.svg",emptyTitle.textContent="Остановись унтерменш! Noooooo",event.target.value.length<2&&setTimeout(()=>{emoji.src="img/norm.svg",emptyTitle.textContent="Этот список пуст, как и твоя душа!"},2e3)):(emoji.src="img/open.svg",emptyTitle.textContent="Идет набор текста...")}form.addEventListener("submit",addTask),window.addEventListener("load",Task.renderList),list.addEventListener("click",action.bind(this));
//# sourceMappingURL=app.js.map
